# 📐 项目架构设计文档

## 一、架构目标

本项目旨在构建一个支持多智能体协同的大模型驱动的软件工程平台，覆盖从需求分析到开发、测试、部署、文档生成的完整软件生命周期。平台核心以模块化架构设计为原则，确保系统的可扩展性、灵活性与高可维护性。

---

## 二、总体架构

系统采用前后端分离、服务模块化 + 智能代理协作的设计，分为以下四大层次：

[前端交互层]
- React + Tailwind UI
- 多Agent交互可视化、任务管理、控制面板、文档区

[应用服务层（FastAPI）]
- 用户与权限模块
- 需求管理模块
- 架构与数据库设计生成模块
- 模块代码生成模块
- 测试用例生成与执行模块
- 文档自动生成模块
- Agent调度与行为控制模块

[AI服务层]
- Prompt模板管理
- 多Agent大模型交互（GPT/Claude/HF本地）
- Agent行为存档、反馈与再调优

[数据与存储层]
- PostgreSQL：结构化数据（需求、任务、用户等）
- MinIO/S3：代码与文档文件存储
- Redis：任务状态缓存与Agent运行时信息


---

## 三、核心模块说明

### 1. 用户与权限模块

- 支持注册、登录（JWT认证）
- 项目级角色分配：产品经理、开发、测试、运维等
- 用户行为审计、权限控制（只读/可编辑）

### 2. 需求管理模块

- 需求编辑、分类、版本控制
- 状态流转：待评审 → 已确认 → 已冻结
- 多人协同与评论支持

### 3. 架构生成模块

- 输入：自然语言需求文档
- 输出：
  - 架构建议（分层设计、微服务划分、技术栈推荐）
  - API接口结构（RESTful）
  - 数据库设计（ER图说明、SQL建表语句）

### 4. 模块代码生成模块

- 根据架构生成Controller、Service、DAO等代码模板
- 支持语言切换（如Python/Java）
- 提供代码可视化与手动调整支持

### 5. 测试用例模块

- 自动生成单元测试、接口测试脚本（pytest/Postman）
- 集成CI工具执行并报告（覆盖率、通过率）
- 测试失败自动定位责任模块

### 6. 部署与监控模块

- 自动生成Dockerfile、K8s配置
- 可部署至本地K8s或远程服务器
- 状态监控与日志汇总展示（Prometheus + Grafana）

### 7. 文档生成模块

- 自动整合生成需求、设计、测试、部署文档
- 支持导出为PDF/Markdown格式
- 提供项目总览页面

---

## 四、智能 Agent 子系统

| Agent 角色 | 职责 |
|------------|------|
| 产品经理 Agent | 理解用户需求，提出结构建议 |
| 架构师 Agent | 拟定系统架构方案与数据库设计 |
| 开发者 Agent | 编写对应模块代码，建议模块接口设计 |
| 测试 Agent | 自动生成测试脚本并执行 |
| 运维 Agent | 配置部署脚本，报告运行状态 |

所有Agent通过统一控制面板调度，可配置“行为风格”、“语言输出风格”、“精度偏好”等参数，并可在运行中被暂停/更换/合并任务。

---

## 五、技术选型

| 层级 | 技术栈 |
|------|--------|
| 前端 | React、Tailwind、shadcn/ui |
| 后端 | FastAPI、SQLAlchemy、Pydantic |
| 数据库 | PostgreSQL + Redis |
| 文档/对象存储 | MinIO 或 AWS S3 |
| 模型接口 | OpenAI API、HuggingFace LLM、LangChain |
| 部署 | Docker、Kubernetes、GitHub Actions |

---

## 六、部署拓扑图

   ┌────────────┐
   │   Nginx    │
   └─────▲──────┘
         │
 ┌───────┴────────┐
 │   FastAPI 应用 │
 └──────┬─────────┘
        │
┌────────┴──────────────┐
│ PostgreSQL Redis │
└────────▲──────────────┘
│
┌────┴────┐
│ MinIO/S3│（文档/代码）
└─────────┘

---

## 七、数据流示意

[用户输入需求] → 存储至DB
↓
调用大模型生成架构 + 数据库设计
↓
按模块生成代码 → 自动生成测试
↓
部署构建镜像 → 运行 → 监控状态返回
↓
自动汇总项目文档并支持导出


---

## 八、后续规划

- Agent智能演化（根据交互行为自动调整prompt）
- 多语言支持（中英自动切换 + 代码注释多语言）
- 接入RAG机制增强架构生成效果
- 可视化架构编辑器（图形方式编辑生成结果）

